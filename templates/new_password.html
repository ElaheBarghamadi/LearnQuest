{% extends 'base.html' %}
{% block title %}رمز عبور جدید - لرن کویست{% endblock %}
{% block extra_css %}
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #FF6584;
            --accent: #36D1DC;
            --success: #4CAF50;
            --warning: #FF9800;
            --dark: #2D3047;
            --light: #F8F9FA;
            --text: #333333;
            --text-light: #6C757D;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        .auth-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 40px;
            background: white;
            border-radius: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .auth-container::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .auth-header p {
            color: var(--text-light);
            font-size: 1rem;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--light);
            border-radius: 15px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: 'Vazirmatn', sans-serif;
            background: var(--light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
            background: white;
        }

        .password-strength {
            margin-top: 8px;
            font-size: 0.8rem;
        }

        .strength-weak {
            color: var(--secondary);
        }

        .strength-medium {
            color: var(--warning);
        }

        .strength-strong {
            color: var(--success);
        }

        .btn-auth {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-family: 'Vazirmatn', sans-serif;
        }

        .btn-auth:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(108, 99, 255, 0.3);
        }

        .info-box {
            background: linear-gradient(135deg, rgba(108, 99, 255, 0.1), rgba(54, 209, 220, 0.1));
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-right: 4px solid var(--primary);
        }

        .info-box h4 {
            color: var(--primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box p {
            color: var(--text-light);
            margin: 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .password-requirements {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 5px;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="auth-container">
        <div class="auth-header">
            <h2>رمز عبور جدید</h2>
            <p>لطفاً رمز عبور جدید خود را وارد کنید</p>
        </div>

        <div class="info-box">
            <h4>
                <i class="fas fa-lock"></i>
                امنیت رمز عبور
            </h4>
            <p>رمز عبور قوی باید شامل حروف بزرگ و کوچک، اعداد و علائم ویژه باشد</p>
        </div>

        <form method="post">
            {% csrf_token %}

            <div class="form-group">
                <input type="password" name="new_password1" class="form-control" placeholder="رمز عبور جدید" required
                       oninput="checkPasswordStrength(this.value)">
                <div class="password-strength" id="passwordStrength"></div>
                <div class="password-requirements">
                    حداقل ۸ کاراکتر، شامل حروف بزرگ و کوچک و اعداد
                </div>
                {% if form.new_password1.errors %}
                    <div style="color: var(--secondary); font-size: 0.9rem; margin-top: 5px;">
                        <i class="fas fa-exclamation-circle"></i>
                        {{ form.new_password1.errors.0 }}
                    </div>
                {% endif %}
            </div>

            <div class="form-group">
                <input type="password" name="new_password2" class="form-control" placeholder="تکرار رمز عبور جدید"
                       required
                       oninput="checkPasswordMatch()">
                <div class="password-strength" id="passwordMatch"></div>
                {% if form.new_password2.errors %}
                    <div style="color: var(--secondary); font-size: 0.9rem; margin-top: 5px;">
                        <i class="fas fa-exclamation-circle"></i>
                        {{ form.new_password2.errors.0 }}
                    </div>
                {% endif %}
            </div>

            <button type="submit" class="btn-auth">
                <i class="fas fa-lock"></i>
                تغییر رمز عبور
            </button>
        </form>
    </div>

    <script>
        function checkPasswordStrength(password) {
            const strengthElement = document.getElementById('passwordStrength');
            let strength = 'ضعیف';
            let strengthClass = 'strength-weak';

            if (password.length >= 8) {
                const hasUpperCase = /[A-Z]/.test(password);
                const hasLowerCase = /[a-z]/.test(password);
                const hasNumbers = /\d/.test(password);
                const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);

                let score = 0;
                if (hasUpperCase) score++;
                if (hasLowerCase) score++;
                if (hasNumbers) score++;
                if (hasSpecial) score++;
                if (password.length >= 12) score++;

                if (score >= 4) {
                    strength = 'قوی';
                    strengthClass = 'strength-strong';
                } else if (score >= 2) {
                    strength = 'متوسط';
                    strengthClass = 'strength-medium';
                }
            }

            if (password.length > 0) {
                strengthElement.innerHTML = `<span class="${strengthClass}">${strength}</span>`;
            } else {
                strengthElement.innerHTML = '';
            }
        }

        function checkPasswordMatch() {
            const password1 = document.querySelector('input[name="new_password1"]').value;
            const password2 = document.querySelector('input[name="new_password2"]').value;
            const matchElement = document.getElementById('passwordMatch');

            if (password2.length > 0) {
                if (password1 === password2) {
                    matchElement.innerHTML = '<span class="strength-strong">رمزها مطابقت دارند</span>';
                } else {
                    matchElement.innerHTML = '<span class="strength-weak">رمزها مطابقت ندارند</span>';
                }
            } else {
                matchElement.innerHTML = '';
            }
        }
    </script>
{% endblock %}